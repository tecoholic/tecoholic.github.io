<!DOCTYPE html>
<html lang="en-us">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <title>
Jupyter - Finding the point when a line graph crosses the threshold | Arunmozhi
</title>

    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">

<meta name="generator" content="Hugo 0.154.5">


<link rel="canonical" href="http://localhost:1313/2020/04/22/jupyter-finding-the-point-when-a-line-graph-crosses-the-threshold/" >




<link href="/css/style.min.66302fa6c122ab7804faa4bd6465554ac4d746c25294af622826d0445b79ab94.css" rel="stylesheet">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer">
<link rel="stylesheet" href="/css/custom.css">



</head>

<body>

    <div class="flexWrapper">
        <header class="headerWrapper">
    <div class="header">
        <div>
            <a class="terminal" href="/">
                <span>Arunmozhi@arunmozhi.in ~ $</span>
            </a>
        </div>
        <input class="side-menu" type="checkbox" id="side-menu">
        <label class="hamb" for="side-menu"><span class="hamb-line"></span></label>
        <nav class="headerLinks">
            <ul>
                
                <li>
                    <a href="http://localhost:1313/posts/" title="" >
                        ~/blog</a>
                </li>
                
                <li>
                    <a href="http://localhost:1313/about/" title="" >
                        ~/about</a>
                </li>
                
            </ul>
        </nav>
    </div>
</header>


        <div class="content">
            <main class="main">
                
<div class="postWrapper">
        <h1>Jupyter - Finding the point when a line graph crosses the threshold</h1>
        

    
    
    
    

    
    
    
    
    

    
    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    <section class="postMetadata">
        <dl>
            
                
<dt>tags</dt>
<dd><span></span>
    <a href="/tags/jupyter/">#Jupyter</a><span></span>
    <a href="/tags/python/">#Python</a></dd>
            
            
            
                
<dt>categories</dt>
<dd><span></span>
    <a href="/categories/coding/">Coding</a></dd>
            
            
                <dt>published</dt>
                 
                 
                 <dd><time datetime="2020-04-22">2020-04-22</time></dd>
            
            
                <dt>reading time</dt>
                <dd>3 minutes</dd>
            
        </dl>
    </section>
    
        <div>
            <p>A friend of came up with the problem. There are a set of points [(x, y), (x1, y1), (x2, &hellip;]. He wanted to find the points at which this line would pass the value Z less than the peak. If the maximum value is 100 and Z = 20. He wanted to find the points where it would cross y = 80.</p>
<p>Now there are multiple ways to solve this problem. I attempted a simple linear interpolation solution.</p>
<blockquote>
<p>I don&rsquo;t the solution itself to be a big thing. What I am really impressed is, how neatly I was able to present the solution using Jupyter Notebook to him.</p>
</blockquote>
<p>I was able to document the solution in a step by step fashion, with visual representation of how I solved it.</p>
<p>Take a look</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> IPython.display <span style="color:#f92672">import</span> display
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>f <span style="color:#f92672">=</span> [<span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">102</span>, <span style="color:#ae81ff">103.5</span>, <span style="color:#ae81ff">105.5</span>, <span style="color:#ae81ff">106.5</span>, <span style="color:#ae81ff">107.5</span>, <span style="color:#ae81ff">108.5</span>, <span style="color:#ae81ff">110</span>]
</span></span><span style="display:flex;"><span>mag <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">30</span>, <span style="color:#ae81ff">40</span>, <span style="color:#ae81ff">145.3</span>, <span style="color:#ae81ff">166.5</span>, <span style="color:#ae81ff">164.5</span>, <span style="color:#ae81ff">75.79</span>, <span style="color:#ae81ff">65.3</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>fig, ax <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots()
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>plot(f, mag)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> x,y <span style="color:#f92672">in</span> zip(f, mag):
</span></span><span style="display:flex;"><span> label <span style="color:#f92672">=</span> ax<span style="color:#f92672">.</span>text(x, y, y)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>fig<span style="color:#f92672">.</span>tight_layout()
</span></span></code></pre></div><p><img src="/img/wp-content/uploads/2020/04/inter_fig_1.png" alt="inter_fig_1"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>gap <span style="color:#f92672">=</span> <span style="color:#ae81ff">30</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1. Find the maximum value</span>
</span></span><span style="display:flex;"><span>max_mag <span style="color:#f92672">=</span> max(mag)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2. Set the threshold value</span>
</span></span><span style="display:flex;"><span>y <span style="color:#f92672">=</span> max_mag <span style="color:#f92672">-</span> gap
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>hlines(y, f[<span style="color:#ae81ff">0</span>], f[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>], linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;cyan&#34;</span>)
</span></span><span style="display:flex;"><span>display(fig)
</span></span></code></pre></div><p><img src="/img/wp-content/uploads/2020/04/inter_fig_2.png" alt="inter_fig_2"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>max_idx <span style="color:#f92672">=</span> mag<span style="color:#f92672">.</span>index(max_mag)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 4. Find the left and right values which are lower than the &#34;y&#34; you are looking for</span>
</span></span><span style="display:flex;"><span>left_start_idx <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>left_end_idx <span style="color:#f92672">=</span> max_idx
</span></span><span style="display:flex;"><span>right_start_idx <span style="color:#f92672">=</span> max_idx
</span></span><span style="display:flex;"><span>right_end_idx <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(max_idx):
</span></span><span style="display:flex;"><span> left_idx <span style="color:#f92672">=</span> max_idx <span style="color:#f92672">-</span> i
</span></span><span style="display:flex;"><span> right_idx <span style="color:#f92672">=</span> max_idx <span style="color:#f92672">+</span> i
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#75715e"># if left index is more than Zero (array left most is 0) and left is not yet set</span>
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">if</span> left_idx <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">and</span> <span style="color:#f92672">not</span> left_start_idx:
</span></span><span style="display:flex;"><span> value <span style="color:#f92672">=</span> mag[left_idx]
</span></span><span style="display:flex;"><span> <span style="color:#75715e"># if the value is lower than our threshold then pickup the point</span>
</span></span><span style="display:flex;"><span> <span style="color:#75715e"># and the one next to it</span>
</span></span><span style="display:flex;"><span> <span style="color:#75715e"># that will form our segment to interoploate</span>
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">if</span> value <span style="color:#f92672">&lt;</span> y: 
</span></span><span style="display:flex;"><span> left_start_idx <span style="color:#f92672">=</span> left_idx
</span></span><span style="display:flex;"><span> left_end_idx <span style="color:#f92672">=</span> left_idx <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#75715e"># if the right index is less than our array size (0..N) and right is not yet set</span>
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">if</span> right_idx <span style="color:#f92672">&lt;</span> len(mag) <span style="color:#f92672">and</span> <span style="color:#f92672">not</span> right_end_idx:
</span></span><span style="display:flex;"><span> value <span style="color:#f92672">=</span> mag[right_idx]
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">if</span> value <span style="color:#f92672">&lt;</span> y:
</span></span><span style="display:flex;"><span> right_end_idx <span style="color:#f92672">=</span> right_idx
</span></span><span style="display:flex;"><span> right_start_idx <span style="color:#f92672">=</span> right_idx <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> right_end_idx:
</span></span><span style="display:flex;"><span> print(<span style="color:#e6db74">&#34;Cannot find point on the right lower than </span><span style="color:#e6db74">%d</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> (y))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> left_start_idx:
</span></span><span style="display:flex;"><span> print(<span style="color:#e6db74">&#34;Cannot find point on the left lower than </span><span style="color:#e6db74">%d</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> (y))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Plotting the lines we will be interpolating</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> left_mag <span style="color:#f92672">and</span> right_mag:
</span></span><span style="display:flex;"><span> ax<span style="color:#f92672">.</span>plot(
</span></span><span style="display:flex;"><span> [f[left_start_idx], f[left_end_idx]],
</span></span><span style="display:flex;"><span> [mag[left_start_idx], mag[left_end_idx]],
</span></span><span style="display:flex;"><span> color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;red&#39;</span>
</span></span><span style="display:flex;"><span> )
</span></span><span style="display:flex;"><span> ax<span style="color:#f92672">.</span>plot(
</span></span><span style="display:flex;"><span> [f[right_start_idx], f[right_end_idx]],
</span></span><span style="display:flex;"><span> [mag[right_start_idx], mag[right_end_idx]],
</span></span><span style="display:flex;"><span> color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;red&#39;</span>
</span></span><span style="display:flex;"><span> )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>display(fig)
</span></span></code></pre></div><p><img src="/img/wp-content/uploads/2020/04/inter_fg_3.png" alt="inter_fg_3"></p>
<h4 id="now-let-us-use-the-line-equation">Now Let us use the line equation</h4>
<p>$latex frac{y - y1}{x - x1} = frac{y2 - y1}{x2 - x1}$</p>
<p>Solving for x we get</p>
<p>$latex x = x1 + (x2 - x1) frac{y - y1}{y2 - y1}$</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Left point interpolation</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>y1 <span style="color:#f92672">=</span> mag[left_start_idx]
</span></span><span style="display:flex;"><span>y2 <span style="color:#f92672">=</span> mag[left_end_idx]
</span></span><span style="display:flex;"><span>x1 <span style="color:#f92672">=</span> f[left_start_idx]
</span></span><span style="display:flex;"><span>x2 <span style="color:#f92672">=</span> f[left_end_idx]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">=</span> x1 <span style="color:#f92672">+</span> (x2 <span style="color:#f92672">-</span> x1) <span style="color:#f92672">*</span> (y <span style="color:#f92672">-</span> y1) <span style="color:#f92672">/</span> (y2 <span style="color:#f92672">-</span> y1)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>scatter([x], [y], color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;green&#34;</span>)
</span></span><span style="display:flex;"><span>display(fig)
</span></span></code></pre></div><p><img src="/img/wp-content/uploads/2020/04/inter_fig_4.png" alt="inter_fig_4"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Right point interpolation</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>y1 <span style="color:#f92672">=</span> mag[right_start_idx]
</span></span><span style="display:flex;"><span>y2 <span style="color:#f92672">=</span> mag[right_end_idx]
</span></span><span style="display:flex;"><span>x1 <span style="color:#f92672">=</span> f[right_start_idx]
</span></span><span style="display:flex;"><span>x2 <span style="color:#f92672">=</span> f[right_end_idx]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">=</span> x1 <span style="color:#f92672">+</span> (x2 <span style="color:#f92672">-</span> x1) <span style="color:#f92672">*</span> (y <span style="color:#f92672">-</span> y1) <span style="color:#f92672">/</span> (y2 <span style="color:#f92672">-</span> y1)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>scatter([x], [y], color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;green&#34;</span>)
</span></span><span style="display:flex;"><span>display(fig)
</span></span></code></pre></div><p><img src="/img/wp-content/uploads/2020/04/inter_fig_5.png" alt="inter_fig_5"></p>
<p>I was able to export the whole thing as a PDF and send it to him.</p>

        </div>

        
        <nav class="postNav" aria-label="Post navigation">
            
                <a class="postNav-prev postNav-button" href="/2020/05/13/thoughts-on-the-git-branch-pr-model/">
                    <span class="postNav-label"><span aria-hidden="true" class="postNav-arrow">←</span> Newer</span>
                    <span class="postNav-title">Thoughts on The Git Branch PR Model</span>
                </a>
            
            
                <a class="postNav-next postNav-button" href="/2020/04/07/building-a-quick-and-dirty-data-collection-app-with-react-google-sheets-and-aws-s3/">
                    <span class="postNav-label">Older <span aria-hidden="true" class="postNav-arrow">→</span></span>
                    <span class="postNav-title">Building a quick and dirty data collection app with React, Google Sheets and AWS S3</span>
                </a>
            
        </nav>
        
</div>

            </main>
        </div>


        <footer class="footer">
    
        <span>
            © 2026 Arunmozhi, Built with
            <a href="https://gohugo.io" class="footerLink">Hugo</a> and
            <a href="https://github.com/LordMathis/hugo-theme-nightfall" class="footerLink">Nightfall</a> theme
        </span>
    
</footer>
    </div>

</body>

</html>
