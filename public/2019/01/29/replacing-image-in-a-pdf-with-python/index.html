<!DOCTYPE html>
<html lang="en-us">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <title>
Replacing image in a PDF with Python | Arunmozhi
</title>

    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">

<meta name="generator" content="Hugo 0.154.5">


<link rel="canonical" href="http://localhost:1313/2019/01/29/replacing-image-in-a-pdf-with-python/" >




<link href="/css/style.min.66302fa6c122ab7804faa4bd6465554ac4d746c25294af622826d0445b79ab94.css" rel="stylesheet">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer">
<link rel="stylesheet" href="/css/custom.css">



</head>

<body>

    <div class="flexWrapper">
        <header class="headerWrapper">
    <div class="header">
        <div>
            <a class="terminal" href="/">
                <span>Arunmozhi@arunmozhi.in ~ $</span>
            </a>
        </div>
        <input class="side-menu" type="checkbox" id="side-menu">
        <label class="hamb" for="side-menu"><span class="hamb-line"></span></label>
        <nav class="headerLinks">
            <ul>
                
                <li>
                    <a href="http://localhost:1313/posts/" title="" >
                        ~/blog</a>
                </li>
                
                <li>
                    <a href="http://localhost:1313/about/" title="" >
                        ~/about</a>
                </li>
                
            </ul>
        </nav>
    </div>
</header>


        <div class="content">
            <main class="main">
                
<div class="postWrapper">
        <h1>Replacing image in a PDF with Python</h1>
        

    
    
    
    

    
    
    
    
    

    
    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    <section class="postMetadata">
        <dl>
            
                
<dt>tags</dt>
<dd><span></span>
    <a href="/tags/python/">#Python</a></dd>
            
            
            
                
<dt>categories</dt>
<dd><span></span>
    <a href="/categories/coding/">Coding</a></dd>
            
            
                <dt>published</dt>
                 
                 
                 <dd><time datetime="2019-01-29">2019-01-29</time></dd>
            
            
                <dt>reading time</dt>
                <dd>4 minutes</dd>
            
        </dl>
    </section>
    
        <div>
            <p>Being a freelancer is an interesting role. You come across a variety of projects. I recently worked on a project involving replacing images in a PDF which taught me a couple of things.</p>
<ol>
<li>While there are a number of tools to deal with PDF in Python, the general purpose tools can only do so much because&hellip; reason 2</li>
<li>PDF is a dump of instructions to put things in specific places. There is no logical way it is done that make general purposes tools manipulate the PDF in a consistent way.</li>
<li>Not everything is bad. Almost all positive changes like adding text or image and whole page changes like rotating, cropping are usually possible and so are all read operations like text, image extraction ..etc.,</li>
<li>The issue is when you want to delete something and replace it with something else.</li>
</ol>
<p>With that learnt, I set out to achieve the goal anyway.</p>
<h3 id="step-1---understanding-the-format">Step 1 - Understanding the format</h3>
<p>Humans invented the PDF format, which means they used words to describe things in the file, which means we can read them. So opening a PDF file in a text editor like VIM will show something like this.</p>
<p><img src="/img/wp-content/uploads/2019/01/screenshot-2019-01-28-at-9.58.10-pm.png" alt="PDF in VIM"></p>
<p>Without getting into the entirety of the PDF spec, let us see what this means. PDF is a collection of objects. There is usually an identifier like <code>int int obj</code> followed by some metadata and then a stream of binary information starting with <code>stream</code> and ends with <code>endstream</code> and <code>endobj</code>. A image in our case would be represented as</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>16 0 obj
</span></span><span style="display:flex;"><span>&lt;&lt; /Length 17 0 R /Type /XObject /Subtype /Image /Width 242 /Height 291 /Interpolate
</span></span><span style="display:flex;"><span>true /ColorSpace 7 0 R /Intent /Perceptual /BitsPerComponent 8 /Filter /DCTDecode
</span></span><span style="display:flex;"><span>&gt;&gt;
</span></span><span style="display:flex;"><span>stream
</span></span><span style="display:flex;"><span>Image binary data here like ÿØÿá^@VExif^@^@MM^@*^@^@^@^H^@^D^A^Z^@^E^@^@
</span></span><span style="display:flex;"><span>endstream
</span></span><span style="display:flex;"><span>endobj
</span></span></code></pre></div><p>So to successfully replace an image we will have to replace the image binary data and the metadata like width and height.</p>
<h3 id="step-2---uncompressing-the-pdf-and-extracting-the-images">Step 2 - Uncompressing the PDF and extracting the images</h3>
<p>Use a PDF manipulation called toolkit called PDFtk.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>pdftk sample.pdf output uncompressed.pdf uncompress
</span></span></code></pre></div><p>What this command does is, it uncompresses the file and makes it easier to read and manipulate. Let us open the <code>uncompressed.pdf</code> in VIM to see the difference.</p>
<p><img src="/img/wp-content/uploads/2019/01/uncompressed-pdf.png" alt="uncompressed pdf"></p>
<h3 id="step-3---identifying-the-image-to-replace">Step 3 - Identifying the image to replace</h3>
<p>PDF is essentially a collection of objects and a PDF file might contain multiple images, there is no way to identify a particular image in the binary data of the PDF file (unless you are from Matrix). We will have to first extract the images from the PDF and match the PDF object to the image using its metadata like height and width. To do that install <code>pdfimages</code> command-line tool (part of poppler-utils) and run <code>pdfimages -list uncompressed.pdf</code>. This will list all the images in the PDF with their metadata.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>page num type width height color comp bpc enc interp object ID x-ppi y-ppi size ratio
</span></span><span style="display:flex;"><span>--------------------------------------------------------------------------------------------
</span></span><span style="display:flex;"><span> 1 0 image 277 185 icc 3 8 jpeg yes 11 0 113 113 69.2K 46%
</span></span><span style="display:flex;"><span> 1 1 image 277 185 icc 3 8 jpeg yes 10 0 113 113 31.9K 21%
</span></span><span style="display:flex;"><span> 1 2 image 242 291 icc 3 8 jpeg yes 12 0 112 112 55.2K 27%
</span></span></code></pre></div><p>Next extract all the images in their original formats using</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pdfimages -all uncompressed.pdf image
</span></span></code></pre></div><p>That extracts the files and names them after the prefix we provided like this <code>image-000.jpg image-001.jpg image-002.jpg</code>.</p>
<p>Now open your images check their file&rsquo;s height, width and file size and mark the details for the one to replace. In my case the file details were:</p>
<ul>
<li>height - 185</li>
<li>width - 277</li>
<li>size - 70836</li>
</ul>
<p>There are two images which matches the height and width, thankfully they have different file sizes.</p>
<h3 id="step-4---identifying-the-object-in-pdf-that-represents-the-image">Step 4 - Identifying the object in PDF that represents the image</h3>
<p>I opened the <code>uncompressed.pdf</code> in VIM and searched for the most unique value I have found for the image - its size.</p>
<p><img src="/img/wp-content/uploads/2019/01/identifying-the-image-object.png" alt="identifying the image object"></p>
<p>Now we can identify the object identifier, in this case it is <code>11 0 obj</code>.</p>
<h3 id="step-5---replacing-the-image-with-another-image">Step 5 - Replacing the image with another image</h3>
<p>Now the job is to switch the object 11&rsquo;s image data with our image&rsquo;s data. You can use the following Python script to achieve that.</p>
<p>
<a href="https://gist.github.com/e44f727f77c74e50f4d70ff10539350b" target="_blank" rel="noopener">https://gist.github.com/e44f727f77c74e50f4d70ff10539350b</a>
</p>
<p>Download the file, change the <code>OBJECT_ID</code> value, save the file and run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>python process.py &lt;your pdf&gt; &lt;new image&gt;
</span></span></code></pre></div><p>I just used the one of the extracted images to replace another one. So here are the before and after images.</p>
<p><img src="/img/wp-content/uploads/2019/01/image-replaced-pdf.png" alt="image replaced pdf"></p>
<h3 id="step-6---compressing-the-file-back-optional">Step 6 - Compressing the file back (OPTIONAL)</h3>
<p>Do this only if you really need to do it for some reason. It is usually cool to just use the uncompressed file.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>pdftk uncompressed.pdf output replaced.pdf compress
</span></span></code></pre></div>
        </div>

        
        <nav class="postNav" aria-label="Post navigation">
            
                <a class="postNav-prev postNav-button" href="/2019/02/03/do-government-teachers-deserve-better-pay-than-private-teachers-in-tamilnadu/">
                    <span class="postNav-label"><span aria-hidden="true" class="postNav-arrow">←</span> Newer</span>
                    <span class="postNav-title">Do Government Teachers Deserve Better Pay Than Private Teachers in Tamilnadu?</span>
                </a>
            
            
                <a class="postNav-next postNav-button" href="/2019/01/28/map-of-pm-modis-domestic-visits/">
                    <span class="postNav-label">Older <span aria-hidden="true" class="postNav-arrow">→</span></span>
                    <span class="postNav-title">Map of PM Modi's Domestic Visits</span>
                </a>
            
        </nav>
        
</div>

            </main>
        </div>


        <footer class="footer">
    
        <span>
            © 2026 Arunmozhi, Built with
            <a href="https://gohugo.io" class="footerLink">Hugo</a> and
            <a href="https://github.com/LordMathis/hugo-theme-nightfall" class="footerLink">Nightfall</a> theme
        </span>
    
</footer>
    </div>

</body>

</html>
