<!DOCTYPE html>
<html lang="en-us">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <title>
Simplifying JSON parsing in Flask routes using decorators | Arunmozhi
</title>

    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">

<meta name="generator" content="Hugo 0.154.5">


<link rel="canonical" href="http://localhost:1313/2019/07/26/simplifying-json-parsing-in-flask-routes-using-decorators/" >




<link href="/css/style.min.66302fa6c122ab7804faa4bd6465554ac4d746c25294af622826d0445b79ab94.css" rel="stylesheet">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer">
<link rel="stylesheet" href="/css/custom.css">



</head>

<body>

    <div class="flexWrapper">
        <header class="headerWrapper">
    <div class="header">
        <div>
            <a class="terminal" href="/">
                <span>Arunmozhi@arunmozhi.in ~ $</span>
            </a>
        </div>
        <input class="side-menu" type="checkbox" id="side-menu">
        <label class="hamb" for="side-menu"><span class="hamb-line"></span></label>
        <nav class="headerLinks">
            <ul>
                
                <li>
                    <a href="http://localhost:1313/posts/" title="" >
                        ~/blog</a>
                </li>
                
                <li>
                    <a href="http://localhost:1313/about/" title="" >
                        ~/about</a>
                </li>
                
            </ul>
        </nav>
    </div>
</header>


        <div class="content">
            <main class="main">
                
<div class="postWrapper">
        <h1>Simplifying JSON parsing in Flask routes using decorators</h1>
        

    
    
    
    

    
    
    
    
    

    
    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    <section class="postMetadata">
        <dl>
            
                
<dt>tags</dt>
<dd><span></span>
    <a href="/tags/flask/">#Flask</a><span></span>
    <a href="/tags/python/">#Python</a></dd>
            
            
            
                
<dt>categories</dt>
<dd><span></span>
    <a href="/categories/coding/">Coding</a></dd>
            
            
                <dt>published</dt>
                 
                 
                 <dd><time datetime="2019-07-26">2019-07-26</time></dd>
            
            
                <dt>reading time</dt>
                <dd>4 minutes</dd>
            
        </dl>
    </section>
    
        <div>
            <p>Flask is simple and effective when it comes to reading input parameters from the URL. For example, take a look at this simple route.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#a6e22e">@app.route</span>(<span style="color:#e6db74">&#34;/todo/&lt;int:id&gt;/&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">task</span>(id):
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">return</span> jsonify({<span style="color:#e6db74">&#34;id&#34;</span>: id, <span style="color:#e6db74">&#34;task&#34;</span>: <span style="color:#e6db74">&#34;Write code&#34;</span>})
</span></span></code></pre></div><p>You specify a parameter called <code>id</code> and set its type as <code>int</code>, Flask automatically parses the value from the URL converts it to an integer and makes it available as a parameter in the <code>task</code> function.</p>
<p>But it becomes harder when we start working with JSON being passed on as inputs when we build APIs.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#a6e22e">@app.route</span>(<span style="color:#e6db74">&#34;/todo/&#34;</span>, methods<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#34;POST&#34;</span>])
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">create_task</span>():
</span></span><span style="display:flex;"><span> incoming <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span>get_json()
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;task&#34;</span> <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> incoming:
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">return</span> jsonify({<span style="color:#e6db74">&#34;status&#34;</span>: <span style="color:#e6db74">&#34;error&#34;</span>, <span style="color:#e6db74">&#34;message&#34;</span>: <span style="color:#e6db74">&#34;Missing parameter &#39;task&#39;&#34;</span>}), <span style="color:#ae81ff">400</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> tasks<span style="color:#f92672">.</span>append(incoming[<span style="color:#e6db74">&#34;task&#34;</span>])
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;Task added successfully&#34;</span>, <span style="color:#ae81ff">201</span>
</span></span></code></pre></div><p>The above method requires the JSON input to contain <code>task</code> parameter in order to create a new task. So it has to check if that parameter is send during the request before it can add the task to the task list. This is simple to implement for just a few parameters. In the real world the APIs aren&rsquo;t always simple. For example, if you envision an address book API, you probably have multiple fields like first name, last name, address line 1, address line 2, city, state, zip code&hellip;etc., and writing something like</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;first_name&#34;</span> <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> incoming:
</span></span><span style="display:flex;"><span> <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;last_name&#34;</span> <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> incoming:
</span></span><span style="display:flex;"><span> <span style="color:#f92672">...</span>
</span></span></code></pre></div><p>is going to be tedious. We can perhaps take a more pythonic approach and write the logic as:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#a6e22e">@app.route</span>(<span style="color:#e6db74">&#34;/address/&#34;</span>, methods<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#34;POST&#34;</span>])
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add_address</span>():
</span></span><span style="display:flex;"><span> required_params <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;first_name&#34;</span>, <span style="color:#e6db74">&#34;last_name&#34;</span>, <span style="color:#e6db74">&#34;addr_1&#34;</span>, 
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;addr_2&#34;</span>, <span style="color:#e6db74">&#34;city&#34;</span>, <span style="color:#e6db74">&#34;state&#34;</span>, <span style="color:#e6db74">&#34;zip_code&#34;</span>
</span></span><span style="display:flex;"><span> ]
</span></span><span style="display:flex;"><span> incoming <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span>get_json()
</span></span><span style="display:flex;"><span> missing <span style="color:#f92672">=</span> [rp <span style="color:#66d9ef">for</span> rp <span style="color:#f92672">in</span> required_params <span style="color:#66d9ef">if</span> rp <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> incoming]
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">if</span> missing:
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">return</span> jsonify({
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;status&#34;</span>: <span style="color:#e6db74">&#34;error&#34;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;message&#34;</span>: <span style="color:#e6db74">&#34;Missing required parameters&#34;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;missing&#34;</span>: missing
</span></span><span style="display:flex;"><span> }), <span style="color:#ae81ff">400</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#75715e"># Add the address to your address book</span>
</span></span><span style="display:flex;"><span> addresses<span style="color:#f92672">.</span>append(incoming)
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;Address added successfully&#34;</span>, <span style="color:#ae81ff">201</span>
</span></span></code></pre></div><p>As you write more routes, you will start to notice that the <code>missing</code> and <code>if missing</code> logic repeating itself in all the places where we are expecting JSON data. Instead of repeating the logic over and over, we can simplify it by putting it in a decorator like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">required_params</span>(<span style="color:#f92672">*</span>args):
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;&#34;&#34;Decorator factory to check request data for POST requests and return
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> an error if required parameters are missing.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span> required <span style="color:#f92672">=</span> list(args)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">decorator</span>(fn):
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;&#34;&#34;Decorator that checks for the required parameters&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">@wraps</span>(fn)
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">wrapper</span>(<span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs):
</span></span><span style="display:flex;"><span> missing <span style="color:#f92672">=</span> [r <span style="color:#66d9ef">for</span> r <span style="color:#f92672">in</span> required <span style="color:#66d9ef">if</span> r <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> request<span style="color:#f92672">.</span>get_json()]
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">if</span> missing:
</span></span><span style="display:flex;"><span> response <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;status&#34;</span>: <span style="color:#e6db74">&#34;error&#34;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;message&#34;</span>: <span style="color:#e6db74">&#34;Request JSON is missing some required params&#34;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;missing&#34;</span>: missing
</span></span><span style="display:flex;"><span> }
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">return</span> jsonify(response), <span style="color:#ae81ff">400</span>
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">return</span> fn(<span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs)
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">return</span> wrapper
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">return</span> decorator
</span></span></code></pre></div><p>Now we can write the same <code>add_address</code> route like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#a6e22e">@app.route</span>(<span style="color:#e6db74">&#34;/address/&#34;</span>, methods<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#34;POST&#34;</span>])
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@required_params</span>(<span style="color:#e6db74">&#34;first_name&#34;</span>, <span style="color:#e6db74">&#34;last_name&#34;</span>, <span style="color:#e6db74">&#34;addr_1&#34;</span>,<span style="color:#e6db74">&#34;addr_2&#34;</span>, <span style="color:#e6db74">&#34;city&#34;</span>, <span style="color:#e6db74">&#34;state&#34;</span>, <span style="color:#e6db74">&#34;zip_code&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add_address</span>():
</span></span><span style="display:flex;"><span> addresses<span style="color:#f92672">.</span>append(request<span style="color:#f92672">.</span>get_json())
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;Address added successfully&#34;</span>, <span style="color:#ae81ff">201</span>
</span></span></code></pre></div><p>Here is how it has changed</p>
<p><img src="/img/wp-content/uploads/2019/07/json_decorator_diff.png" alt="json_decorator_diff"></p>
<p>The <code>required_params</code> decorator will do the job of checking for the presence of parameters and returning an error. We can add the decorator to any routes that requires JSON parameter validation.</p>
<p>If we put in some more work, we can even expand the logic by specifying the datatypes of those parameters pass a dictionary like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#a6e22e">@route</span>(<span style="color:#f92672">...</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@required_params</span>({<span style="color:#e6db74">&#34;name&#34;</span>: str, <span style="color:#e6db74">&#34;age&#34;</span>: int, <span style="color:#e6db74">&#34;married&#34;</span>: bool})
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#f92672">...</span>
</span></span></code></pre></div><p>and in the decorator perform the validations</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">required_params</span>(required):
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">decorator</span>(fn):
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;&#34;&#34;Decorator that checks for the required parameters&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">@wraps</span>(fn)
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">wrapper</span>(<span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs):
</span></span><span style="display:flex;"><span> _json <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span>get_json()
</span></span><span style="display:flex;"><span> missing <span style="color:#f92672">=</span> [r <span style="color:#66d9ef">for</span> r <span style="color:#f92672">in</span> required<span style="color:#f92672">.</span>keys()
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">if</span> r <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> _json]
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">if</span> missing:
</span></span><span style="display:flex;"><span> response <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;status&#34;</span>: <span style="color:#e6db74">&#34;error&#34;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;message&#34;</span>: <span style="color:#e6db74">&#34;Request JSON is missing some required params&#34;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;missing&#34;</span>: missing
</span></span><span style="display:flex;"><span> }
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">return</span> jsonify(response), <span style="color:#ae81ff">400</span>
</span></span><span style="display:flex;"><span> wrong_types <span style="color:#f92672">=</span> [r <span style="color:#66d9ef">for</span> r <span style="color:#f92672">in</span> required<span style="color:#f92672">.</span>keys()
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> isinstance(_json[r], required[r])]
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">if</span> wrong_types:
</span></span><span style="display:flex;"><span> response <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;status&#34;</span>: <span style="color:#e6db74">&#34;error&#34;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;message&#34;</span>: <span style="color:#e6db74">&#34;Data types in the request JSON doesn&#39;t match the required format&#34;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;param_types&#34;</span>: {k: str(v) <span style="color:#66d9ef">for</span> k, v <span style="color:#f92672">in</span> required<span style="color:#f92672">.</span>items()}
</span></span><span style="display:flex;"><span> }
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">return</span> jsonify(response), <span style="color:#ae81ff">400</span>
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">return</span> fn(<span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs)
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">return</span> wrapper
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">return</span> decorator
</span></span></code></pre></div><p>With this if a JSON field is sent with the wrong datatype an appropriate response will be returned as well.</p>
<p>PS: I found 
<a href="https://gist.github.com/corbinbs/3791168" target="_blank" rel="noopener">this full blown decorator</a>
 function with custom error messages and validations after I wrote this post. Check it out if you want even more functionality.</p>

        </div>

        
        <nav class="postNav" aria-label="Post navigation">
            
                <a class="postNav-prev postNav-button" href="/2019/08/12/investing-in-gilt-funds/">
                    <span class="postNav-label"><span aria-hidden="true" class="postNav-arrow">←</span> Newer</span>
                    <span class="postNav-title">Investing in GILT funds</span>
                </a>
            
            
                <a class="postNav-next postNav-button" href="/2019/07/24/osm-mapping-with-ai-from-facebook/">
                    <span class="postNav-label">Older <span aria-hidden="true" class="postNav-arrow">→</span></span>
                    <span class="postNav-title">OSM Mapping with AI from Facebook</span>
                </a>
            
        </nav>
        
</div>

            </main>
        </div>


        <footer class="footer">
    
        <span>
            © 2026 Arunmozhi, Built with
            <a href="https://gohugo.io" class="footerLink">Hugo</a> and
            <a href="https://github.com/LordMathis/hugo-theme-nightfall" class="footerLink">Nightfall</a> theme
        </span>
    
</footer>
    </div>

</body>

</html>
